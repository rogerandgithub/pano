/*! sti-pano 2015-12-25 */
function quaternion2euler(a,b,c,d){var e=Math.atan2(2*(a*b+c*d),1-2*(b*b+c*c)),f=Math.asin(2*(a*c-d*b)),g=Math.atan2(2*(a*d+b*c),1-2*(c*c+d*d));return[e,f,g]}function getQuaternion(a,b,c){var d=Math.PI/180,e=b?b*d:0,f=c?c*d:0,g=a?a*d:0,h=Math.cos(e/2),i=Math.cos(f/2),j=Math.cos(g/2),k=Math.sin(e/2),l=Math.sin(f/2),m=Math.sin(g/2),n=h*i*j-k*l*m,o=k*i*j-h*l*m,p=h*l*j+k*i*m,q=h*i*m+k*l*j;return[n,o,p,q]}function position2Rotation(a,b,c){function d(a,b){return 0!=a&&0!=b?a>0?Math.atan(b/a):Math.PI+Math.atan(b/a):0==a?b>0?Math.PI/2:-Math.PI/2:0>a?Math.PI:0}if(void 0==c)return d(a,b);var e=d(a,b),f=distance3D(a,b,c,0,0,0),g=Math.acos(c/f);return[g,e];var f,g,e}var unbindOrientation=function(){window.removeEventListener("orientationchange"),window.removeEventListener("deviceorientation")},bindOrientation=function(a){var b=this;window.addEventListener("orientationchange",function(){b.screenOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(){if(sti.vr){var b=getQuaternion(event.alpha,event.beta,event.gamma);a(b[0],b[1],b[2],b[3])}})},distance2D=function(a,b,c,d){return Math.pow((a-c)*(a-c)+(b-d)*(b-d),.5)},distance3D=function(a,b,c,d,e,f){return Math.pow((a-d)*(a-d)+(b-e)*(b-e)+(c-f)*(c-f),.5)},epsilon=function(a){return a=parseFloat(a),Math.abs(a)<1e-6?0:a.toFixed(5)},text2Matrix=function(a){var b=new WebKitCSSMatrix(a);return[epsilon(b.m11),epsilon(b.m12),epsilon(b.m13),epsilon(b.m14),epsilon(b.m21),epsilon(b.m22),epsilon(b.m23),epsilon(b.m24),epsilon(b.m31),epsilon(b.m32),epsilon(b.m33),epsilon(b.m34),epsilon(b.m41),epsilon(b.m42),epsilon(b.m43),epsilon(b.m44)]},matrix2Text=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return"object"==typeof a?"matrix3d("+a.join(",")+")":"matrix3d("+a+","+b+","+c+","+d+","+e+","+f+","+g+","+h+","+i+","+j+","+k+","+l+","+m+","+n+","+o+","+p+")"},multiplyMatrix=function(a,b){var c=[a[0]*b[0]+a[1]*b[4]+a[2]*b[8]+a[3]*b[12],a[0]*b[1]+a[1]*b[5]+a[2]*b[9]+a[3]*b[13],a[0]*b[2]+a[1]*b[6]+a[2]*b[10]+a[3]*b[14],a[0]*b[3]+a[1]*b[7]+a[2]*b[11]+a[3]*b[15],a[4]*b[0]+a[5]*b[4]+a[6]*b[8]+a[7]*b[12],a[4]*b[1]+a[5]*b[5]+a[6]*b[9]+a[7]*b[13],a[4]*b[2]+a[5]*b[6]+a[6]*b[10]+a[7]*b[14],a[4]*b[3]+a[5]*b[7]+a[6]*b[11]+a[7]*b[15],a[8]*b[0]+a[9]*b[4]+a[10]*b[8]+a[11]*b[12],a[8]*b[1]+a[9]*b[5]+a[10]*b[9]+a[11]*b[13],a[8]*b[2]+a[9]*b[6]+a[10]*b[10]+a[11]*b[14],a[8]*b[3]+a[9]*b[7]+a[10]*b[11]+a[11]*b[15],a[12]*b[0]+a[13]*b[4]+a[14]*b[8]+a[15]*b[12],a[12]*b[1]+a[13]*b[5]+a[14]*b[9]+a[15]*b[13],a[12]*b[2]+a[13]*b[6]+a[14]*b[10]+a[15]*b[14],a[12]*b[3]+a[13]*b[7]+a[14]*b[11]+a[15]*b[15]];return c},multiplyMatrixs=function(a){if(1==a.length)return a[0];for(var b=[multiplyMatrix(a[1],a[0])],c=2;c<a.length;++c)b.push(a[c]);return multiplyMatrixs(b)};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(a){window.clearTimeout(a)}}();